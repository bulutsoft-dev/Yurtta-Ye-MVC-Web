@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@{
    ViewData["Title"] = "Excel'den Men√º Y√ºkle";
    ViewData["BreadcrumbItems"] = new List<dynamic>
    {
        new { Text = "Men√º Y√∂netimi", Icon = "fas fa-utensils", Url = Url.Action("Index", "AdminMenu", new { area = "Admin" }) },
        new { Text = "Excel Y√ºkle", Icon = "fas fa-upload", Url = (string)null }
    };
}

@Html.AntiForgeryToken()

<!-- Main Content -->
<div class="max-w-3xl mx-auto">
    <!-- Info Card -->
    <div class="admin-card bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-6 mb-6 border border-orange-200">
        <div class="flex items-center">
            <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-amber-600 rounded-xl flex items-center justify-center mr-4">
                <i class="fas fa-file-excel text-white text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-900">Excel Dosyasƒ±ndan Men√º Y√ºkle</h3>
                <p class="text-sm text-gray-600">Excel dosyasƒ± (.xlsx veya .xls) kullanarak toplu men√º verisi aktarƒ±n.</p>
            </div>
        </div>
    </div>

    <!-- Upload Form Card -->
    <div class="admin-card bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-orange-600 to-amber-600 px-6 py-4">
            <h2 class="text-xl font-bold text-white flex items-center">
                <i class="fas fa-upload mr-3"></i>
                Dosya Y√ºkle
            </h2>
        </div>

        <form asp-area="Admin" asp-controller="AdminMenu" asp-action="Upload" method="post" enctype="multipart/form-data" class="p-6">
            @Html.AntiForgeryToken()
            
            <!-- Drag and Drop Area -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-file-excel text-green-500 mr-2"></i>
                    @Localizer["ExcelFile"]
                </label>
                
                <div id="drop-zone" 
                     class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center transition-colors hover:border-orange-400 hover:bg-orange-50 cursor-pointer"
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)"
                     ondrop="handleDrop(event)"
                     onclick="document.getElementById('file-input').click()">
                    
                    <div id="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-4"></i>
                        <p class="text-lg font-medium text-gray-700 mb-2">Dosyayƒ± s√ºr√ºkle bƒ±rak veya tƒ±kla</p>
                        <p class="text-sm text-gray-500">Desteklenen formatlar: .xlsx, .xls</p>
                    </div>
                    
                    <div id="file-info" class="hidden">
                        <i class="fas fa-file-excel text-5xl text-green-500 mb-4"></i>
                        <p class="text-lg font-medium text-gray-700" id="file-name"></p>
                        <p class="text-sm text-gray-500" id="file-size"></p>
                    </div>
                </div>
                
                <input type="file" 
                       name="file" 
                       id="file-input"
                       class="hidden" 
                       accept=".xlsx,.xls"
                       onchange="handleFileSelect(this)" />
            </div>

            <!-- Excel Format Info -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h4 class="text-sm font-semibold text-blue-900 mb-3 flex items-center">
                    <i class="fas fa-info-circle mr-2"></i>
                    Excel Dosya Formatƒ±
                </h4>
                <div class="text-sm text-blue-800">
                    <p class="mb-2">Excel dosyanƒ±z a≈üaƒüƒ±daki s√ºtunlarƒ± i√ßermelidir:</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs">
                        <span class="bg-blue-100 px-2 py-1 rounded">üìç ≈ûehir</span>
                        <span class="bg-blue-100 px-2 py-1 rounded">üìÖ Tarih</span>
                        <span class="bg-blue-100 px-2 py-1 rounded">üçΩÔ∏è √ñƒü√ºn T√ºr√º</span>
                        <span class="bg-blue-100 px-2 py-1 rounded">ü•ó Kategori</span>
                        <span class="bg-blue-100 px-2 py-1 rounded">üç≤ Yemek Adƒ±</span>
                        <span class="bg-blue-100 px-2 py-1 rounded">‚öñÔ∏è Gram</span>
                    </div>
                </div>
            </div>

            <!-- Divider -->
            <div class="border-t border-gray-200 my-6"></div>

            <!-- Action Buttons -->
            <div class="flex items-center justify-between">
                <a asp-area="Admin" asp-controller="AdminMenu" asp-action="Index" 
                   class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    @Localizer["Back"]
                </a>
                
                <div class="flex items-center space-x-3">
                    <button type="button" 
                            onclick="clearFile()"
                            class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-times mr-2"></i>
                        Temizle
                    </button>
                    <button type="submit" 
                            id="submit-btn"
                            disabled
                            class="inline-flex items-center px-6 py-2 bg-gradient-to-r from-orange-600 to-amber-600 text-white rounded-lg hover:from-orange-700 hover:to-amber-700 transition-all shadow-lg transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                        <i class="fas fa-upload mr-2"></i>
                        @Localizer["Upload"]
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Sample Download Card -->
    <div class="admin-card bg-white rounded-xl shadow-sm border border-gray-200 p-6 mt-6">
        <h4 class="text-sm font-semibold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-download text-blue-500 mr-2"></i>
            √ñrnek ≈ûablon
        </h4>
        <p class="text-sm text-gray-600 mb-4">
            Doƒüru formatta Excel dosyasƒ± olu≈üturmak i√ßin √∂rnek ≈üablonu indirebilirsiniz.
        </p>
        <a href="#" 
           class="inline-flex items-center px-4 py-2 bg-green-100 text-green-700 border border-green-200 rounded-lg hover:bg-green-200 transition-colors">
            <i class="fas fa-file-download mr-2"></i>
            √ñrnek ≈ûablon ƒ∞ndir
        </a>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            showAdminNotification('@TempData["Success"]', 'success');
        });
    </script>
}
@if (TempData["Error"] != null)
{
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            showAdminNotification('@TempData["Error"]', 'error');
        });
    </script>
}

@section Scripts {
    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const submitBtn = document.getElementById('submit-btn');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.add('border-orange-500', 'bg-orange-50');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('border-orange-500', 'bg-orange-50');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('border-orange-500', 'bg-orange-50');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect(fileInput);
            }
        }

        function handleFileSelect(input) {
            const file = input.files[0];
            if (file) {
                // Validate file type
                const validTypes = ['.xlsx', '.xls', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'];
                const fileExtension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
                
                if (!validTypes.includes(fileExtension) && !validTypes.includes(file.type)) {
                    showAdminNotification('Ge√ßersiz dosya formatƒ±! Sadece .xlsx ve .xls dosyalarƒ± kabul edilir.', 'error');
                    clearFile();
                    return;
                }
                
                uploadPlaceholder.classList.add('hidden');
                fileInfo.classList.remove('hidden');
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                submitBtn.disabled = false;
                
                showAdminNotification('Dosya se√ßildi: ' + file.name, 'success');
            }
        }

        function clearFile() {
            fileInput.value = '';
            uploadPlaceholder.classList.remove('hidden');
            fileInfo.classList.add('hidden');
            submitBtn.disabled = true;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
}